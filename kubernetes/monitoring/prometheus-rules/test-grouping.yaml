---
# yaml-language-server: $schema=https://kubernetes-schemas.pages.dev/monitoring.coreos.com/prometheusrule_v1.json
apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  labels:
    prometheus: k8s
    role: alert-rules
  name: test-grouping-rules
  namespace: monitoring
spec:
  groups:
  - name: test-grouping.rules
    interval: 30s
    rules:
    # Test alert that will fire on all nodes - simulates cluster-wide issue
    - alert: TestMultiInstanceAlert
      expr: up{job="node-exporter"} > 0
      for: 10s
      labels:
        severity: warning
        test: "true"
      annotations:
        summary: "Test alert for grouping validation (instance {{ $labels.instance }})"
        description: "This is a test alert that fires on multiple instances to validate grouping configuration.\n  INSTANCE: {{ $labels.instance }}\n  This alert should be grouped appropriately and not exceed Discord payload limits."
        title: "Test Multi-Instance Alert"
    
    # Test alert that simulates pod-level issues
    - alert: TestPodCrashLooping
      expr: kube_pod_container_status_restarts_total > -1
      for: 10s
      labels:
        severity: critical
        test: "true"
      annotations:
        summary: "Test pod alert (pod {{ $labels.pod }} in {{ $labels.namespace }})"
        description: "This test alert simulates pod-level issues to validate namespace-based grouping.\n  POD: {{ $labels.pod }}\n  NAMESPACE: {{ $labels.namespace }}"
        title: "Test Pod Issue"
