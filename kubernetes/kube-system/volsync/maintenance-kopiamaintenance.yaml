---
# yaml-language-server: $schema=https://raw.githubusercontent.com/perfectra1n/volsync/main/config/crd/bases/volsync.backube_kopiamaintenances.yaml
apiVersion: volsync.backube/v1alpha1
kind: KopiaMaintenance
metadata:
  name: kopia-maintenance
  namespace: kube-system
spec:
  repoSecretRef: kopia-maintenance-secret
  schedule: "0 3 * * 0"  # Weekly Sunday at 3 AM
  timeoutSeconds: 14400  # 4 hours for large repository first run
  podSecurityContext:
    runAsNonRoot: true
    runAsUser: 1001
    runAsGroup: 1001
    fsGroup: 1001
    fsGroupChangePolicy: OnRootMismatch
    seccompProfile:
      type: RuntimeDefault
  containerSecurityContext:
    allowPrivilegeEscalation: false
    readOnlyRootFilesystem: true
    capabilities:
      drop: ["ALL"]
  cache:
    capacity: 10Gi
    accessModes: ["ReadWriteOnce"]
    storageClassName: ceph-block
