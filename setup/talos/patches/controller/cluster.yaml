cluster:
  allowSchedulingOnControlPlanes: false
  apiServer:
    extraArgs:
      enable-aggregator-routing: true
      feature-gates: MutatingAdmissionPolicy=true
      runtime-config: admissionregistration.k8s.io/v1beta1=true
      # Increase timeout for single control plane under load
      request-timeout: "120s"
      min-request-timeout: "30"
  controllerManager:
    extraArgs:
      bind-address: 0.0.0.0
  coreDNS:
    disabled: true
  # discovery:
  #   enabled: true
  #   registries:
  #     kubernetes:
  #       disabled: false
  #     service:
  #       disabled: true
  etcd:
    extraArgs:
      listen-metrics-urls: http://0.0.0.0:2381
      # Prevent database bloat with auto-compaction
      auto-compaction-mode: periodic
      auto-compaction-retention: "1h"
      # Increase max database size for cluster growth
      quota-backend-bytes: "8589934592"  # 8GB
      # More frequent snapshots reduce WAL size
      snapshot-count: "10000"
  proxy:
    disabled: true
  scheduler:
    extraArgs:
      bind-address: 0.0.0.0
    config:
      apiVersion: kubescheduler.config.k8s.io/v1
      kind: KubeSchedulerConfiguration
      profiles:
        - schedulerName: default-scheduler
          plugins:
            score:
              disabled:
                - name: ImageLocality
          pluginConfig:
            - name: PodTopologySpread
              args:
                defaultingType: List
                defaultConstraints:
                  - maxSkew: 1
                    topologyKey: kubernetes.io/hostname
                    whenUnsatisfiable: ScheduleAnyway

